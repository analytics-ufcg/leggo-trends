---
title: "Pressão das proposições pelo Google Trends"
author: "Equipe Leg.go"
date: "12/08/2019"
output:
  prettydoc::html_pretty:
    theme: leonids
    highlight: github
---

```{r knitr_init, echo=FALSE, message=FALSE, warning=FALSE, cache=FALSE, paged.print=FALSE, results="asis"}
library(magrittr)
library(tidyverse)
library(readr)
library(plotly)
library(lubridate)
library(ggplot2)

knitr::opts_chunk$set(echo = FALSE,
	             cache = FALSE,
               prompt = FALSE,
               tidy = FALSE,
               comment = NA,
               message = FALSE,
               warning = FALSE)
```

```{r, message=FALSE}
previdencia_nome_formal <- read_csv("../data/nova_previdencia.csv") %>% 
  mutate(nome_formal = "pec 06/2019")

liberdade_economica_nome_formal <- read_csv("../data/liberdade_economica.csv") %>% 
  mutate(nome_formal = "mpv 881/2019 ")

mercado_agua_nome_formal <- read_csv("../data/mercado_da_agua.csv") %>% 
  mutate(nome_formal = "pls 495/2017")

props_nome_formal <- bind_rows(previdencia_nome_formal, 
                               liberdade_economica_nome_formal,
                               mercado_agua_nome_formal)
```


```{r, message=FALSE}
previdencia_apelido <- read_csv("../data/nova_previdencia_apelido.csv") %>% 
  mutate(apelido = "nova previdência")
liberdade_economica_apelido <- read_csv("../data/liberdade_economica_apelido.csv")%>% 
  mutate(apelido = "liberdade econômica")

props_apelido <- bind_rows(previdencia_apelido,
                           liberdade_economica_apelido)

```

```{r, message=FALSE}
previdencia_comparacao <- read_csv("../data/comparacao_previdencia.csv")
liberdade_economica_comparacao <- read_csv("../data/comparacao_liberdade_economica.csv")
```


```{r}
semana <- previdencia_nome_formal %>% 
  mutate(semana = epiweek(date)) %>% 
  group_by(nome_formal, semana) %>% 
  summarise(pop_semana = max(pop))

p <- semana %>%  ggplot() + 
  geom_area(aes(x=semana, y = pop_semana), fill = "#FF7700") +
  xlab("Tempo") + 
  ylab("Pressão") +
  theme_minimal()

ggplotly(p)

```

**Pico 8ª semana:** Apresentação da Proposta de Emenda à Constituição n. 6/2019, pelo Poder Executivo.

**Pico 12ª semana:** 17/03... Apresentado vários requerimos de realização de Audiência Pública.

**Pico 20ª semana:** 12/05... - Aprovado requerimento do Sr. Paulo Pereira da Silva que requer a realização de Audiência Pública para debater os itens da Proposta de Emenda à Constituição nº 6, de 2019, a Reforma da Previdência, do Poder Executivo (Comissão Especial).

**Pico 28ª semana:** 10/07 - 12/07 votação em primeiro turno no plenário da câmara.

**Queda acentuada 29ª semana:** Recesso parlamentar

```{r}
semana <- liberdade_economica_nome_formal %>% 
  mutate(semana = epiweek(date)) %>% 
  group_by(nome_formal, semana) %>% 
  summarise(pop_semana = max(pop))

p <- semana %>%  ggplot() + 
  geom_area(aes(x=semana, y = pop_semana), fill = "#7678ED") +
  xlab("Tempo") + 
  ylab("Pressão") +
  theme_minimal()

ggplotly(p)

```

**Pico 25ª semana:** 16/06.... - Materia foi recebida pelo relator (CMMPV). Apresentação de 2 requerimentos de audiência pública.

**Pico 28ª semana:** 08/07... - Aprovado parecer na comissão (CMMPV)

**29ª semana:** Medida Provisória enviada à Câmara dos Deputados


```{r}
semana <- mercado_agua_nome_formal %>% 
  mutate(semana = epiweek(date)) %>% 
  group_by(nome_formal, semana) %>% 
  summarise(pop_semana = max(pop))

p <- semana %>%  ggplot() + 
  geom_area(aes(x=semana, y = pop_semana), fill = "#BFACAA") +
  xlab("Tempo") + 
  ylab("Pressão") +
  theme_minimal()

ggplotly(p)

```


**Pico 29ª semana:** 19/07 - ["Consulta pública sobre venda do aquífero Guarani"](https://www1.folha.uol.com.br/poder/2019/07/nao-existe-consulta-publica-sobre-venda-do-aquifero-guarani-nem-bolsonaro-e-guedes-estao-envolvidos.shtml)

Postagem falsa liga governo a PL de 2017 e que não se refere à venda do aquífero Guarani

**Pico 21ª semana:** 20/05 - Não conseguimos explicar

```{r}
# Comparação entre nome formal e apelido
semana_comp <- previdencia_comparacao %>% 
  mutate(semana = epiweek(date)) %>% 
  group_by(semana) %>% 
  summarise(pop_semana_nf = max(pop_nome_formal),
            pop_semana_ap = max(pop_apelido))

semana_comp_ap <- semana_comp %>% 
  select(pop = pop_semana_ap, semana) %>% 
  mutate(nome_prop = "nova previdência")

semana_comp_nf <- semana_comp %>% 
  select(pop = pop_semana_nf, semana) %>% 
  mutate(nome_prop = "pec 06/2019")

semana_comp <- bind_rows(semana_comp_ap, semana_comp_nf)

p <- semana_comp %>% group_by(semana, nome_prop) %>%  ggplot() + 
  geom_area(aes(x=semana, y = pop, fill = nome_prop)) +
  xlab("Tempo") + 
  ylab("Pressão") +
  theme_minimal() +
  facet_grid(rows = vars(nome_prop)) 
  

ggplotly(p)

```
![some caption](previdencia.png)


```{r}
# Comparação entre nome formal e apelido
semana_comp <- liberdade_economica_comparacao %>% 
  mutate(semana = epiweek(date)) %>% 
  group_by(semana) %>% 
  summarise(pop_semana_nf = max(pop_nome_formal),
            pop_semana_ap = max(pop_apelido))

semana_comp_ap <- semana_comp %>% 
  select(pop = pop_semana_ap, semana) %>% 
  mutate(nome_prop = "liberdade econômica")

semana_comp_nf <- semana_comp %>% 
  select(pop = pop_semana_nf, semana) %>% 
  mutate(nome_prop = "mpv 881/2019")

semana_comp <- bind_rows(semana_comp_ap, semana_comp_nf)

p <- semana_comp %>% group_by(semana, nome_prop) %>%  ggplot() + 
  geom_area(aes(x=semana, y = pop, fill = nome_prop)) +
  xlab("Tempo") + 
  ylab("Pressão") +
  theme_minimal() +
  facet_grid(rows = vars(nome_prop)) 
  

ggplotly(p)

```
**Pico 18ª semana:** 30/04... - Publicada no DOU de 30/04/2019, Edição Extra B, na página 1, a Medida Provisória 881/2019.
# ```{r}
# atual_popularidade <- semana_apelido %>% 
#   arrange(desc(semana)) %>% 
#   head(4)
# 
# p <- atual_popularidade %>%
#   ggplot(aes(x=apelido, y=pop_semana, fill=apelido)) +
#   geom_bar(stat="identity") +
#   ggplot2::xlab("Proposição") +
#   ggplot2::ylab("Populariedade") +
#   coord_cartesian(ylim = c(0, 100))
# 
# ggplotly(p)
# ```
